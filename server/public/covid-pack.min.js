function addHideoutMarker(map,details){let defaultImgs=["http://10minuteschool.com/professional/wp-content/uploads/2018/01/icon-enterprise.png"];var rd=Math.round(Math.random()*(defaultImgs.length-1)%(defaultImgs.length-1));var image=details.img||defaultImgs[0];var marker=new HideoutMarker({position:details.pos,map:map},image);google.maps.event.addListener(marker,"click",function(e){marker.animateWobble();showHideoutModal(details,image)});return marker}HideoutMarker.prototype=new google.maps.OverlayView;function HideoutMarker(opts,img){this.imgUrl=img;this.setValues(opts)}HideoutMarker.prototype.getPosition=function(){return this.position};HideoutMarker.prototype.draw=function(){var self=this;var div=this.div;if(!div){div=this.div=$(""+"<div>"+'<div class="shadow"></div>'+'<div class="pin-wrap">'+'<div style="background-image:url('+this.imgUrl+')" class="businesspin"></div>'+"</div>"+"</div>"+"")[0];this.pinWrap=this.div.getElementsByClassName("pin-wrap");this.pin=this.div.getElementsByClassName("pin");this.pinShadow=this.div.getElementsByClassName("shadow");div.style.position="absolute";div.style.cursor="pointer";var panes=this.getPanes();panes.overlayImage.appendChild(div);google.maps.event.addDomListener(div,"click",function(event){google.maps.event.trigger(self,"click",event)})}var point=this.getProjection().fromLatLngToDivPixel(this.position);if(point){div.style.left=point.x+"px";div.style.top=point.y+"px"}};HideoutMarker.prototype.animateDrop=function(){dynamics.stop(this.pinWrap);dynamics.css(this.pinWrap,{transform:"scaleY(2) translateY(-"+$("#map").outerHeight()+"px)",opacity:"1"});dynamics.animate(this.pinWrap,{translateY:0,scaleY:1},{type:dynamics.gravity,duration:1800});dynamics.stop(this.pin);dynamics.css(this.pin,{transform:"none"});dynamics.animate(this.pin,{scaleY:.8},{type:dynamics.bounce,duration:1800,bounciness:600});dynamics.stop(this.pinShadow);dynamics.css(this.pinShadow,{transform:"scale(0,0)"});dynamics.animate(this.pinShadow,{scale:1},{type:dynamics.gravity,duration:1800})};HideoutMarker.prototype.animateBounce=function(){dynamics.stop(this.pinWrap);dynamics.css(this.pinWrap,{transform:"none"});dynamics.animate(this.pinWrap,{translateY:-30},{type:dynamics.forceWithGravity,bounciness:0,duration:500,delay:150});dynamics.stop(this.pin);dynamics.css(this.pin,{transform:"none"});dynamics.animate(this.pin,{scaleY:.8},{type:dynamics.bounce,duration:800,bounciness:0});dynamics.animate(this.pin,{scaleY:.8},{type:dynamics.bounce,duration:800,bounciness:600,delay:650});dynamics.stop(this.pinShadow);dynamics.css(this.pinShadow,{transform:"none"});dynamics.animate(this.pinShadow,{scale:.6},{type:dynamics.forceWithGravity,bounciness:0,duration:500,delay:150})};HideoutMarker.prototype.animateWobble=function(){dynamics.stop(this.pinWrap);dynamics.css(this.pinWrap,{transform:"none"});dynamics.animate(this.pinWrap,{rotateZ:-45},{type:dynamics.bounce,duration:1800});dynamics.stop(this.pin);dynamics.css(this.pin,{transform:"none"});dynamics.animate(this.pin,{scaleX:.8},{type:dynamics.bounce,duration:800,bounciness:1800})};function addClusterMarker(map,details,pulse,cnt){var rd=Math.round(Math.random()*(defaultUserImgs.length-1)%(defaultUserImgs.length-1));var image=details.img||defaultUserImgs[rd];var marker=new ClusterMarker({position:details.pos,map:map,zIndex:1e3},image,pulse,cnt);setTimeout(()=>marker.animateDrop(),300);setInterval(()=>marker.animateBounce(),5e3+Math.round(Math.random()*1e4));return marker}ClusterMarker.prototype=new google.maps.OverlayView;function ClusterMarker(opts,img,pulse,cnt){this.imgUrl=img;this.cntVal=cnt;this.pulse=pulse;this.setValues(opts)}ClusterMarker.prototype.draw=function(){var self=this;var div=this.div;var hasPulse="";if(this.pulse){hasPulse='<div class="pulse"></div>'}if(!div){div=this.div=$(""+"<div>"+'<div class="shadow"></div>'+hasPulse+'<div class="pin-wrap">'+'<div class="count"><div class="avatar">'+this.cntVal+"</div></div>"+"</div>"+"</div>"+"")[0];this.pinWrap=this.div.getElementsByClassName("pin-wrap");this.pin=this.div.getElementsByClassName("pin");this.pinShadow=this.div.getElementsByClassName("shadow");div.style.position="absolute";div.style.cursor="pointer";var panes=this.getPanes();panes.overlayImage.appendChild(div);google.maps.event.addDomListener(div,"click",function(event){google.maps.event.trigger(self,"click",event)})}var point=this.getProjection().fromLatLngToDivPixel(this.position);if(point){div.style.left=point.x+"px";div.style.top=point.y+"px"}};ClusterMarker.prototype.animateDrop=function(){dynamics.stop(this.pinWrap);dynamics.css(this.pinWrap,{transform:"scaleY(2) translateY(-"+$("#map").outerHeight()+"px)",opacity:"1"});dynamics.animate(this.pinWrap,{translateY:0,scaleY:1},{type:dynamics.gravity,duration:1800});dynamics.stop(this.pin);dynamics.css(this.pin,{transform:"none"});dynamics.animate(this.pin,{scaleY:.8},{type:dynamics.bounce,duration:1800,bounciness:600});dynamics.stop(this.pinShadow);dynamics.css(this.pinShadow,{transform:"scale(0,0)"});dynamics.animate(this.pinShadow,{scale:1},{type:dynamics.gravity,duration:1800})};ClusterMarker.prototype.animateBounce=function(){dynamics.stop(this.pinWrap);dynamics.css(this.pinWrap,{transform:"none"});dynamics.animate(this.pinWrap,{translateY:-30},{type:dynamics.forceWithGravity,bounciness:0,duration:500,delay:150});dynamics.stop(this.pin);dynamics.css(this.pin,{transform:"none"});dynamics.animate(this.pin,{scaleY:.8},{type:dynamics.bounce,duration:800,bounciness:0});dynamics.animate(this.pin,{scaleY:.8},{type:dynamics.bounce,duration:800,bounciness:600,delay:650});dynamics.stop(this.pinShadow);dynamics.css(this.pinShadow,{transform:"none"});dynamics.animate(this.pinShadow,{scale:.6},{type:dynamics.forceWithGravity,bounciness:0,duration:500,delay:150})};ClusterMarker.prototype.animateWobble=function(){dynamics.stop(this.pinWrap);dynamics.css(this.pinWrap,{transform:"none"});dynamics.animate(this.pinWrap,{rotateZ:-45},{type:dynamics.bounce,duration:1800});dynamics.stop(this.pin);dynamics.css(this.pin,{transform:"none"});dynamics.animate(this.pin,{scaleX:.8},{type:dynamics.bounce,duration:800,bounciness:1800})};function clusterMarkers(map,users,business,drawLine,bounds){let businessMarker=addHideoutMarker(map,business);bounds.extend(business.pos);let lat=0;let lng=0;let len=users.length;let i=-1;while(++i<users.length){let user=users[i];lat+=user.lat;lng+=user.lng}let newLat=lat/len;let newLng=lng/len;let pos=new google.maps.LatLng(newLat,newLng);bounds.extend(pos);addClusterMarker(map,{pos:pos},false,len);if(drawLine){drawPolyLine(map,pos,businessMarker.position)}}function drawPolyLine(map,markerP1,markerP2){var now;var then=Date.now();var delta;var step=0;var lineSymbol={path:"M 0,-1 0,1",strokeOpacity:1,scale:3};var line=new google.maps.Polyline({path:[markerP1,markerP2],strokeColor:"#EE4A22",strokeOpacity:1,strokeWeight:2,geodesic:true,map:map});function draw(){requestAnimationFrame(draw);now=Date.now();delta=now-then;if(delta>interval){then=now-delta%interval;step+=1;if(step>numSteps){line.setPath([markerP1,markerP1]);step=0}else{var are_we_there_yet=google.maps.geometry.spherical.interpolate(markerP1,markerP2,step/numSteps);line.setPath([markerP1,are_we_there_yet])}}}draw()}function addNewsMarker(map,details){let defaultImgs=["https://proxy.duckduckgo.com/iu/?u=http%3A%2F%2Fz3technology.com%2FcmsCart%2Fupload%2FResources%2FNews%2520Icon.png&f=1"];var rd=Math.round(Math.random()*(defaultImgs.length-1)%(defaultImgs.length-1));var image=details.img||defaultImgs[0];var marker=new NewsMarker({position:details.pos,map:map},image);google.maps.event.addListener(marker,"click",function(e){marker.animateWobble();showNewsModal(details,image)});return marker}NewsMarker.prototype=new google.maps.OverlayView;function NewsMarker(opts,img){this.imgUrl=img;this.setValues(opts)}NewsMarker.prototype.getPosition=function(){return this.position};NewsMarker.prototype.draw=function(){var self=this;var div=this.div;if(!div){div=this.div=$(""+"<div>"+'<div class="shadow"></div>'+'<div class="pulse"></div>'+'<div class="pin-wrap">'+'<div style="background-image:url('+this.imgUrl+')" class="newspin"></div>'+"</div>"+"</div>"+"")[0];this.pinWrap=this.div.getElementsByClassName("pin-wrap");this.pin=this.div.getElementsByClassName("pin");this.pinShadow=this.div.getElementsByClassName("shadow");div.style.position="absolute";div.style.cursor="pointer";var panes=this.getPanes();panes.overlayImage.appendChild(div);google.maps.event.addDomListener(div,"click",function(event){google.maps.event.trigger(self,"click",event)})}var point=this.getProjection().fromLatLngToDivPixel(this.position);if(point){div.style.left=point.x+"px";div.style.top=point.y+"px"}};NewsMarker.prototype.animateDrop=function(){dynamics.stop(this.pinWrap);dynamics.css(this.pinWrap,{transform:"scaleY(2) translateY(-"+$("#map").outerHeight()+"px)",opacity:"1"});dynamics.animate(this.pinWrap,{translateY:0,scaleY:1},{type:dynamics.gravity,duration:1800});dynamics.stop(this.pin);dynamics.css(this.pin,{transform:"none"});dynamics.animate(this.pin,{scaleY:.8},{type:dynamics.bounce,duration:1800,bounciness:600});dynamics.stop(this.pinShadow);dynamics.css(this.pinShadow,{transform:"scale(0,0)"});dynamics.animate(this.pinShadow,{scale:1},{type:dynamics.gravity,duration:1800})};NewsMarker.prototype.animateBounce=function(){dynamics.stop(this.pinWrap);dynamics.css(this.pinWrap,{transform:"none"});dynamics.animate(this.pinWrap,{translateY:-30},{type:dynamics.forceWithGravity,bounciness:0,duration:500,delay:150});dynamics.stop(this.pin);dynamics.css(this.pin,{transform:"none"});dynamics.animate(this.pin,{scaleY:.8},{type:dynamics.bounce,duration:800,bounciness:0});dynamics.animate(this.pin,{scaleY:.8},{type:dynamics.bounce,duration:800,bounciness:600,delay:650});dynamics.stop(this.pinShadow);dynamics.css(this.pinShadow,{transform:"none"});dynamics.animate(this.pinShadow,{scale:.6},{type:dynamics.forceWithGravity,bounciness:0,duration:500,delay:150})};NewsMarker.prototype.animateWobble=function(){dynamics.stop(this.pinWrap);dynamics.css(this.pinWrap,{transform:"none"});dynamics.animate(this.pinWrap,{rotateZ:-45},{type:dynamics.bounce,duration:1800});dynamics.stop(this.pin);dynamics.css(this.pin,{transform:"none"});dynamics.animate(this.pin,{scaleX:.8},{type:dynamics.bounce,duration:800,bounciness:1800})};function pairMarkers(map,users,business,drawLine,bounds){bounds.extend(business.pos);let businessMarker=addHideoutMarker(map,business);let i=-1;while(++i<users.length){let user=users[i];bounds.extend(user.pos);let userMarker=addUserMarker(map,user,false);if(drawLine){drawPolyLine(map,userMarker.position,businessMarker.position)}}}var fps=60;var interval=1e3/fps;var numSteps=100;Number.prototype.round=function(p){p=p||10;return parseFloat(this.toFixed(p))};$(function(){var checked=$(".cbox");checked.click(function(){if(checked.prop("checked")){$(".add").text("Hit Enter to Submit")}if(!checked.prop("checked")){$(".message").val("");$(".add").text("Enter Code")}});initMap().then(([map,bounds])=>{function zoomCalgary(){let calgaryPosition=new google.maps.LatLng(51.043048,-114.061094);fps=60;interval=1e3/fps;numSteps=400;map.setZoom(16);map.panTo(calgaryPosition)}function zoomToronto(){let calgaryPosition=new google.maps.LatLng(44.1,-79);fps=60;interval=1e3/fps;numSteps=1e3;map.setZoom(9);map.panTo(calgaryPosition)}function zoomVancouver(){let calgaryPosition=new google.maps.LatLng(49.2,-123);fps=60;interval=1e3/fps;numSteps=1e3;map.setZoom(9);map.panTo(calgaryPosition)}function zoomCanada(){fps=60;interval=1e3/fps;numSteps=100;map.fitBounds(bounds)}function enterCode(){showCodeModal({},"")}function showDecoder(){showDecodeModal({},"")}$(".zoomCalgary").on("click",zoomCalgary);$(".zoomCanada").on("click",zoomCanada);$(".zoomVancouver").on("click",zoomVancouver);$(".zoomToronto").on("click",zoomToronto);$(".showDecoder").on("click",showDecoder);$(".enterCode").on("click",enterCode)})});function initMap(){return new Promise((resolve,reject)=>{let pos=new google.maps.LatLng(51,-114);var map=null;let promiseList=[fetchHideouts(),fetchSpies(),fetchNews()];Promise.all(promiseList).then(data=>{var news=data[2];var spies=data[1];var hideouts=data[0];$("#hideoutCnt").html(hideouts.length);$("#spyCnt").html(spies.length);$("#newsCnt").html(news.length);map=new google.maps.Map(document.getElementById("map"),{zoom:6,center:pos,disableDefaultUI:true,styles:[{stylers:[{hue:"#00eeff"},{invert_lightness:true}]},{featureType:"road",stylers:[{hue:"#ff6e00"},{lightness:-11},{gamma:2}]},{featureType:"road.arterial",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.local",stylers:[{visibility:"off"}]},{featureType:"water",stylers:[{hue:"#0099ff"},{saturation:100},{lightness:-83},{gamma:1.96}]}]});var bounds=new google.maps.LatLngBounds;let k=-1;let nw=news.length;while(++k<nw){let singleNews=news[k];let users=[];let newLat=parseFloat(singleNews.latLng.split(",")[0]);let newLng=parseFloat(singleNews.latLng.split(",")[1]);let newPost=singleNews.postal_code;let newsPos=new google.maps.LatLng(newLat,newLng);var news_={pos:newsPos,name:singleNews.name,type:singleNews.type};bounds.extend(newsPos);addNewsMarker(map,news_)}let j=-1;let bus=hideouts.length;while(++j<bus){let singleHideout=hideouts[j];let users=[];let busLat=parseFloat(singleHideout.latLng.split(",")[0]);let busLng=parseFloat(singleHideout.latLng.split(",")[1]);let busPost=singleHideout.postal_code;let busPos=new google.maps.LatLng(busLat,busLng);var hideout={pos:busPos,name:singleHideout.name,type:singleHideout.type};let l=-1;let ll=spies.length;while(++l<ll){let spy=spies[l];let userLat=parseFloat(spy.latLng.split(",")[0]);let userLng=parseFloat(spy.latLng.split(",")[1]);let userPos=new google.maps.LatLng(userLat,userLng);var user={pos:userPos,lat:userLat,lng:userLng,name:spy.name,options:spy.options,skills:spy.skills};users.push(user)}pairMarkers(map,users,hideout,true,bounds)}map.fitBounds(bounds);resolve([map,bounds])})})}function fetchNews(){return new Promise((resolve,reject)=>{$.ajax({url:"/news.json",method:"GET",success:function(data){if(typeof data==="string"){resolve(JSON.parse(data))}else{resolve(data)}}})})}function fetchHideouts(){return new Promise((resolve,reject)=>{$.ajax({url:"/hideouts.json",method:"GET",success:function(data){if(typeof data==="string"){resolve(JSON.parse(data))}else{resolve(data)}}})})}function fetchSpies(){return new Promise((resolve,reject)=>{$.ajax({url:"/spies.json",method:"GET",success:function(data){if(typeof data==="string"){resolve(JSON.parse(data))}else{resolve(data)}}})})}const defaultUserImgs=["/images/avatar1.png.jpeg","/images/avatar2.png.jpeg","/images/avatar3.png.jpeg","/images/avatar4.png.jpeg","/images/avatar5.png.jpeg","/images/avatar6.png.jpeg","/images/avatar7.png.jpeg","/images/avatar8.png.jpeg","/images/avatar9.png.jpeg"];function addUserMarker(map,details,pulse){var rd=details.options?Math.round(Math.random()*(details.options.length-1)%(details.options.length-1)):Math.round(Math.random()*(defaultUserImgs.length-1)%(defaultUserImgs.length-1));var image=details.img?details.img:details.options?defaultUserImgs[details.options[rd]-1]:defaultUserImgs[rd];var marker=new UserMarker({position:details.pos,map:map,zIndex:1e3},image,pulse);google.maps.event.addListener(marker,"click",function(e){showSpyModal(details,image)});return marker}UserMarker.prototype=new google.maps.OverlayView;function UserMarker(opts,img,pulse){this.imgUrl=img;this.pulse=pulse;this.setValues(opts)}UserMarker.prototype.draw=function(){var self=this;var div=this.div;var hasPulse="";if(this.pulse){hasPulse='<div class="pulse"></div>'}if(!div){div=this.div=$(""+"<div>"+'<div class="shadow"></div>'+hasPulse+'<div class="pin-wrap">'+'<div style="background-image:url('+this.imgUrl+')" class="pin"></div>'+"</div>"+"</div>"+"")[0];this.pinWrap=this.div.getElementsByClassName("pin-wrap");this.pin=this.div.getElementsByClassName("pin");this.pinShadow=this.div.getElementsByClassName("shadow");div.style.position="absolute";div.style.cursor="pointer";var panes=this.getPanes();panes.overlayImage.appendChild(div);google.maps.event.addDomListener(div,"click",function(event){google.maps.event.trigger(self,"click",event)})}var point=this.getProjection().fromLatLngToDivPixel(this.position);if(point){div.style.left=point.x+"px";div.style.top=point.y+"px"}};UserMarker.prototype.animateDrop=function(){dynamics.stop(this.pinWrap);dynamics.css(this.pinWrap,{transform:"scaleY(2) translateY(-"+$("#map").outerHeight()+"px)",opacity:"1"});dynamics.animate(this.pinWrap,{translateY:0,scaleY:1},{type:dynamics.gravity,duration:1800});dynamics.stop(this.pin);dynamics.css(this.pin,{transform:"none"});dynamics.animate(this.pin,{scaleY:.8},{type:dynamics.bounce,duration:1800,bounciness:600});dynamics.stop(this.pinShadow);dynamics.css(this.pinShadow,{transform:"scale(0,0)"});dynamics.animate(this.pinShadow,{scale:1},{type:dynamics.gravity,duration:1800})};UserMarker.prototype.animateBounce=function(){dynamics.stop(this.pinWrap);dynamics.css(this.pinWrap,{transform:"none"});dynamics.animate(this.pinWrap,{translateY:-30},{type:dynamics.forceWithGravity,bounciness:0,duration:500,delay:150});dynamics.stop(this.pin);dynamics.css(this.pin,{transform:"none"});dynamics.animate(this.pin,{scaleY:.8},{type:dynamics.bounce,duration:800,bounciness:0});dynamics.animate(this.pin,{scaleY:.8},{type:dynamics.bounce,duration:800,bounciness:600,delay:650});dynamics.stop(this.pinShadow);dynamics.css(this.pinShadow,{transform:"none"});dynamics.animate(this.pinShadow,{scale:.6},{type:dynamics.forceWithGravity,bounciness:0,duration:500,delay:150})};UserMarker.prototype.animateWobble=function(){dynamics.stop(this.pinWrap);dynamics.css(this.pinWrap,{transform:"none"});dynamics.animate(this.pinWrap,{rotateZ:-45},{type:dynamics.bounce,duration:1800});dynamics.stop(this.pin);dynamics.css(this.pin,{transform:"none"});dynamics.animate(this.pin,{scaleX:.8},{type:dynamics.bounce,duration:800,bounciness:1800})};
